// Copyright (c) 2023 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as e}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-square-matrix@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.0.2-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@esm/index.mjs";import a from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-numel@esm/index.mjs";function d(e,r){return(r?a:o)("float64",new s(e*e),[e,e],[e,1],0,"row-major")}function l(e,r){var t,s=e.shape[0];for(t=0;t<s;t++)e.set(t,t,r);return e}function h(e){var r;return r=new s(e),a("float64",r,[e],[1],0,"row-major")}function f(o,a){var f,u,p,g,j,c,v,w;if(w=0,e(o))u=d(f=o,!1);else{if(!r(o))throw new TypeError(n("invalid argument. First argument must either specify the order of the correlation matrix or be a square two-dimensional ndarray for storing the correlation matrix. Value: `%s`.",o));f=o.shape[0],u=o}if(u=l(u,1),v=new s(f),p=new s(f),g=new s(f),c=d(f,!0),arguments.length>1){if(!t(a))throw new TypeError(n("invalid argument. Second argument must be a one-dimensional ndarray. Value: `%s`.",a));if(m(a.shape)!==f)throw new Error("invalid argument. The number of elements (means) in the second argument must match correlation matrix dimensions. Expected: "+f+". Actual: "+m(a.shape)+".");return j=a,x}return j=h(f),b;function b(e){var r,s,o,a,m,d,l,h,b,x,y,E;if(0===arguments.length)return 0===w?null:u;if(!t(e))throw new TypeError(n("invalid argument. Must provide a one-dimensional ndarray. Value: `%s`.",e));if(e.shape[0]!==f)throw new Error(n("0ejAH",f,e.shape[0]));if(x=(b=w)/(w+=1),r=b||1,1===w)for(y=0;y<f;y++)for(l=e.get(y),h=j.get(y),h+=(d=l-h)/w,j.set(y,h),v[y]=d,p[y]+=d*(l-h),g[y]=i(p[y]/r),s=x*v[y],E=0;E<y;E++)o=c.get(y,E)+s*v[E],c.set(y,E,o),c.set(E,y,o);else for(y=0;y<f;y++)for(l=e.get(y),h=j.get(y),h+=(d=l-h)/w,j.set(y,h),v[y]=d,p[y]+=d*(l-h),g[y]=i(p[y]/r),s=x*v[y],m=g[y],E=0;E<y;E++)o=c.get(y,E)+s*v[E],c.set(y,E,o),c.set(E,y,o),a=o/r/(m*g[E]),u.set(y,E,a),u.set(E,y,a);return u}function x(e){var r,s,o,a,m,d;if(0===arguments.length)return 0===w?null:u;if(!t(e))throw new TypeError(n("invalid argument. Must provide a one-dimensional ndarray. Value: `%s`.",e));if(e.shape[0]!==f)throw new Error(n("0ejAH",f,e.shape[0]));for(w+=1,m=0;m<f;m++)for(a=e.get(m)-j.get(m),v[m]=a,p[m]+=a*a,g[m]=i(p[m]/w),o=g[m],d=0;d<m;d++)s=c.get(m,d)+a*v[d],c.set(m,d,s),c.set(d,m,s),r=s/w/(o*g[d]),u.set(m,d,r),u.set(d,m,r);return u}}export{f as default};
//# sourceMappingURL=index.mjs.map
