// Copyright (c) 2024 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import{isPrimitive as e}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-positive-integer@v0.2.1-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-square-matrix@v0.2.1-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-vector-like@v0.2.1-esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/array-float64@v0.2.1-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/error-tools-fmtprodmsg@v0.2.1-esm/index.mjs";import i from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sqrt@v0.2.1-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-ctor@v0.2.1-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-ctor@v0.2.1-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-numel@v0.2.1-esm/index.mjs";function f(e,t){return(t?m:o)("float64",new s(e*e),[e,e],[e,1],0,"row-major")}function a(o,a){var h,l,p,j,g,v,c,u;if(u=0,e(o))l=f(h=o,!1);else{if(!t(o))throw new TypeError(n("1JfDf",o));h=o.shape[0],l=o}if(l=function(e,t){var r,s=e.shape[0];for(r=0;r<s;r++)e.set(r,r,t);return e}(l,1),c=new s(h),p=new s(h),j=new s(h),v=f(h,!0),arguments.length>1){if(!r(a))throw new TypeError(n("1JfDc",a));if(d(a.shape)!==h)throw new Error("invalid argument. The number of elements (means) in the second argument must match correlation matrix dimensions. Expected: "+h+". Actual: "+d(a.shape)+".");return g=a,function(e){var t,s,o,m,d,f;if(0===arguments.length)return 0===u?null:l;if(!r(e))throw new TypeError(n("1JfDd",e));if(e.shape[0]!==h)throw new Error(n("1Jf9g",h,e.shape[0]));for(u+=1,d=0;d<h;d++)for(m=e.get(d)-g.get(d),c[d]=m,p[d]+=m*m,j[d]=i(p[d]/u),o=j[d],f=0;f<d;f++)s=v.get(d,f)+m*c[f],v.set(d,f,s),v.set(f,d,s),t=s/u/(o*j[f]),l.set(d,f,t),l.set(f,d,t);return l}}return g=function(e){var t;return t=new s(e),m("float64",t,[e],[1],0,"row-major")}(h),function(e){var t,s,o,m,d,f,a,w,b,x,y,E;if(0===arguments.length)return 0===u?null:l;if(!r(e))throw new TypeError(n("1JfDd",e));if(e.shape[0]!==h)throw new Error(n("1Jf9g",h,e.shape[0]));if(x=(b=u)/(u+=1),t=b||1,1===u)for(y=0;y<h;y++)for(a=e.get(y),w=g.get(y),w+=(f=a-w)/u,g.set(y,w),c[y]=f,p[y]+=f*(a-w),j[y]=i(p[y]/t),s=x*c[y],E=0;E<y;E++)o=v.get(y,E)+s*c[E],v.set(y,E,o),v.set(E,y,o);else for(y=0;y<h;y++)for(a=e.get(y),w=g.get(y),w+=(f=a-w)/u,g.set(y,w),c[y]=f,p[y]+=f*(a-w),j[y]=i(p[y]/t),s=x*c[y],d=j[y],E=0;E<y;E++)o=v.get(y,E)+s*c[E],v.set(y,E,o),v.set(E,y,o),m=o/t/(d*j[E]),l.set(y,E,m),l.set(E,y,m);return l}}export{a as default};
//# sourceMappingURL=index.mjs.map
